<!doctype html>
<html>

  <head>
    <title>Preferences</title>
    <script defer>
      $main.require('style')
      $main.require('node_modules/form-serialize/index.js')
      $main.require('src/ui/scripts/fields.js');

      const settingDefinition = [
        {
          $Label: 'Start with the system',
          $type: 'boolean',
          Name: 'auto_start',
          Help: '',
          Provider: '',
          Default: $main.isAutostart(),
          Value: '',
          ShortOpt: '',
          Hide: 0,
          Required: false,
          IsPassword: false,
          NoPrefix: false,
          Advanced: false
        },
        {
          $Label: 'Check for updates',
          $type: 'boolean',
          Name: 'enable_updates',
          Help: 'Enable checking for updates on application start',
          Provider: '',
          Default: false,
          Value: '',
          ShortOpt: '',
          Hide: 0,
          Required: false,
          IsPassword: false,
          NoPrefix: false,
          Advanced: false
        },
        {
          $Label: 'Show bookmarks type',
          $type: 'boolean',
          Name: 'tray_menu_show_type',
          Help: '',
          Provider: '',
          Default: true,
          Value: '',
          ShortOpt: '',
          Hide: 0,
          Required: false,
          IsPassword: false,
          NoPrefix: false,
          Advanced: false
        },
        {
          Name: 'rclone_config',
          $Label: 'Config',
          $type: 'file',
          Help: 'Changing this option require restart.',
          Provider: '',
          Default: $main.rclone.getConfigFile(),
          Value: '',
          ShortOpt: '',
          Hide: 0,
          Required: false,
          IsPassword: false,
          NoPrefix: false,
          Advanced: false
        },
        {
          Name: 'rclone_use_bundled',
          $Label: 'Use bundled Rclone',
          $type: 'boolean',
          Help: 'Use the Rclone binary that is bundled with the app, otherwise installed system wide version will be used (if not found, then you will receive and error).',
          Provider: '',
          Default: true,
          Value: '',
          ShortOpt: '',
          Hide: 0,
          Required: false,
          IsPassword: false,
          NoPrefix: false,
          Advanced: false
        },
        {
          Name: 'custom_args',
          $Label: 'Custom Rclone setting args.',
          $type: 'text',
          Help: "Space or new-line separated rclone command arguments to be appended to all commands.\nCheck more at https://rclone.org/docs/",
          Value: '',
          ShortOpt: '',
          Hide: 0,
          Required: false,
          IsPassword: false,
          NoPrefix: false,
          Advanced: false
        }
      ]

      document.addEventListener('DOMContentLoaded', function () {
        let container = document.createDocumentFragment()
        settingDefinition.forEach(function (field) {
          container.appendChild(createFieldRow(field, $main.settings.get(field.Name, field.Default || null)))
        })
        document.getElementById('current-provider-settings').appendChild(container)

        let theForm = document.getElementById('the-form')
        theForm.addEventListener('submit', function (event) {
          event.preventDefault();
          let data = serialize(this, {
            hash: true,
            empty: true
          })

          $main.setAutostart(data.auto_start || false)
          if (data.hasOwnProperty('auto_start')) {
            delete data['auto_start']
          }

          $main.settings.merge(data.options)
          $main.tray.refresh()
          window.close()
        })

        window.resizeToContent()
      });
    </script>
  </head>

  <body>
    <main>
      <form id="the-form">
        <div id="current-provider-settings"></div>
        <div class="padded-v right">
          <button type="submit">
            Save
          </button>
        </div>
      </form>
    </main>
  </body>

</html>
