<!doctype html>
<html>

  <head>
    <title>RcloneTray Preferences</title>
    <script defer>
      $main.loadStyles()

      document.addEventListener('DOMContentLoaded', function () {
        let tabs = createTabsElement()
        document.getElementById('current-provider-settings').appendChild(tabs)

        tabs.addTab('General', createOptionsFields([
          {
            $Label: 'Start with the system',
            $Type: 'boolean',
            Name: 'auto_start',
            Help: '',
            Provider: '',
            Default: false,
            Value: $main.isAutostart(),
            ShortOpt: '',
            Hide: 0,
            Required: false,
            IsPassword: false,
            NoPrefix: false,
            Advanced: false
          },
          {
            $Label: 'Check for updates',
            $Type: 'boolean',
            Name: 'enable_updates',
            Help: 'Enable checking for updates on application start',
            Provider: '',
            Default: false,
            Value: '',
            ShortOpt: '',
            Hide: 0,
            Required: false,
            IsPassword: false,
            NoPrefix: false,
            Advanced: false
          },
          {
            $Label: 'Show bookmarks type',
            $Type: 'boolean',
            Name: 'tray_menu_show_type',
            Help: '',
            Provider: '',
            Default: true,
            Value: '',
            ShortOpt: '',
            Hide: 0,
            Required: false,
            IsPassword: false,
            NoPrefix: false,
            Advanced: false
          }
        ], null, $main.settings.getAll()))

        tabs.addTab('Rclone', createOptionsFields([
          {
            Name: 'rclone_config',
            $Label: 'Config',
            $Type: 'file',
            Help: 'Changing this option require restart.',
            Provider: '',
            Default: $main.rclone.getConfigFile(),
            Value: '',
            ShortOpt: '',
            Hide: 0,
            Required: false,
            IsPassword: false,
            NoPrefix: false,
            Advanced: false
          },
          {
            Name: 'rclone_use_bundled',
            $Label: 'Use bundled Rclone',
            $Type: 'boolean',
            Help: 'Use the Rclone binary that is bundled with the app, otherwise installed system wide version will be used (if not found, then you will receive and error).',
            Provider: '',
            Default: true,
            Value: '',
            ShortOpt: '',
            Hide: 0,
            Required: false,
            IsPassword: false,
            NoPrefix: false,
            Advanced: false
          },
          {
            Name: 'custom_args',
            $Label: 'Custom Rclone setting args.',
            $Type: 'text',
            Help: "Space or new-line separated rclone command arguments to be appended to all commands.\nCheck more at https://rclone.org/docs/",
            Value: '',
            ShortOpt: '',
            Hide: 0,
            Required: false,
            IsPassword: false,
            NoPrefix: false,
            Advanced: false
          }
        ], null, $main.settings.getAll()))

        tabs.addTab('Mount', createOptionsFields([
          {
            $Label: 'Enable',
            $Type: 'boolean',
            Name: 'enable_mounts',
            Help: '',
            Provider: '',
            Default: true,
            Value: '',
            ShortOpt: '',
            Hide: 0,
            Required: false,
            IsPassword: false,
            NoPrefix: false,
            Advanced: false
          }
        ], null, $main.settings.getAll()))

        tabs.addTab('Sync', createOptionsFields([
          {
            $Label: 'Enable',
            $Type: 'boolean',
            Name: 'enable_sync',
            Help: '',
            Provider: '',
            Default: true,
            Value: '',
            ShortOpt: '',
            Hide: 0,
            Required: false,
            IsPassword: false,
            NoPrefix: false,
            Advanced: false
          }
        ], null, $main.settings.getAll()))

        tabs.addTab('Serve', createOptionsFields([
          {
            $Label: 'Enable',
            $Type: 'boolean',
            Name: 'enable_serve_http',
            Help: '',
            Provider: '',
            Default: true,
            Value: '',
            ShortOpt: '',
            Hide: 0,
            Required: false,
            IsPassword: false,
            NoPrefix: false,
            Advanced: false
          }
        ], null, $main.settings.getAll()))

        let theForm = document.getElementById('the-form')
        theForm.addEventListener('submit', function (event) {
          event.preventDefault();
          let data = getTheFormData(this)

          let oldAutoStart = $main.isAutostart()
          if (oldAutoStart !== !!(data.auto_start || false)) {
            $main.setAutostart(data.auto_start || false)
          }
          delete data['auto_start']

          $main.settings.merge(data)
          $main.refreshTray()
          window.close()
        })

      });
    </script>
  </head>

  <body>
    <form id="the-form">
      <div id="current-provider-settings"></div>
      <div class="row right">
        <button type="submit">
          Save
        </button>
      </div>
    </form>
  </body>

</html>
