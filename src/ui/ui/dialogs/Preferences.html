<!doctype html>
<html>

  <head>
    <title>RcloneTray Preferences</title>
    <script defer>
      loadStyles()
      loadScripts([
        'node_modules/form-serialize/index.js',
        'src/ui/scripts/fields.js',
      ])
      document.addEventListener('DOMContentLoaded', function() {

        let settingDefinition = [
          {
            $Label: 'Show bookmark type',
            $type: 'bool',
            Name: "tray_menu_show_type",
            "Help": "",
            "Provider": '',
            "Default": true,
            "Value": '',
            "ShortOpt": '',
            "Hide": 0,
            "Required": false,
            "IsPassword": false,
            "NoPrefix": false,
            "Advanced": false
          },
          {
            Name: "rclone_config",
            $title: 'Config',
            $type: 'file',
            "Help": "",
            "Provider": '',
            "Default": $main.rclone.getConfigFile(),
            "Value": '',
            "ShortOpt": '',
            "Hide": 0,
            "Required": false,
            "IsPassword": false,
            "NoPrefix": false,
            "Advanced": false
          },
          {
            Name: "custom_args",
            $title: 'Custom Rclone setting args.',
            $type: 'text',
            "Help": "Auto open system upon start.",
            "Provider": '',
            "Default": '',
            "Value": '',
            "ShortOpt": '',
            "Hide": 0,
            "Required": false,
            "IsPassword": false,
            "NoPrefix": false,
            "Advanced": false
          },
        ]

        let container = document.createDocumentFragment()
        settingDefinition.forEach(function (field) {
          container.appendChild(createFieldRow(field, $main.settings.get(field.Name)))
        })
        document.getElementById('current-provider-settings').appendChild(container)

        let theForm = document.getElementById('the-form')
        theForm.addEventListener('submit', function(event) {
          event.preventDefault();
          let data = serialize(this, {
            hash: true,
            empty: true
          })
          $main.settings.setFromObject(data.options)
          $main.tray.refresh()
          window.close()
        })
      });
    </script>
  </head>

  <body>
    <main>
      <form id="the-form">
        <div id="current-provider-settings"></div>
        <div class="padded-v right">
          <button type="submit">
            Save
          </button>
        </div>
      </form>
    </main>
  </body>

</html>
